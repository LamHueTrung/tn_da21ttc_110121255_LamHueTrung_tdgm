<div class="row add-user mb-4">
    <h1 class="title-add-user text-center mb-4">Add User</h1>

    <!-- Chọn phương thức nhập -->
    <div class="d-flex justify-content-center mb-4">
        <button class="btn btn-darks me-2" id="manualBtn">Add Manually</button>
        <button class="btn btn-choicefile" id="fileBtn">Import from File</button>
    </div>

    <!-- Form thêm thủ công -->
    <div id="manualForm" style="display: none;">
        <form action="/admin/user/addUser" method="POST" enctype="multipart/form-data" class="col-md-6 offset-md-3">
            <div class="mb-3">
                <label class="form-label">User Name</label>
                <input type="text" class="form-control" name="userName" id="userName" placeholder="Example: LamHueTrung" value="{{userName}}">
                {{#if errors.userName}} <div class="text-danger">{{errors.userName}}</div> {{/if}}
            </div>

            <div class="mb-3">
                <label class="form-label">MSGV</label>
                <input type="text" class="form-control" name="code" id="code" placeholder="Examples: GV001" value="{{MSGV}}">
                {{#if errors.MSGV}} <div class="text-danger">{{errors.MSGV}}</div> {{/if}}
            </div>

            <div class="mb-3">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-control" name="fullName" id="fullName" placeholder="Example: Lâm Huệ Trung" value="{{fullName}}">
                {{#if errors.fullName}} <div class="text-danger">{{errors.fullName}}</div> {{/if}}
            </div>

            <div class="mb-3">
                <label class="form-label">Birthday</label>
                <input type="date" class="form-control" name="birthday" id="birthday" value="{{birthday}}">
                {{#if errors.birthday}} <div class="text-danger">{{errors.birthday}}</div> {{/if}}
            </div>

            <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" name="email" id="email" placeholder="Example: 110121255@tvu.edu.vn" value="{{email}}">
                {{#if errors.email}} <div class="text-danger">{{errors.email}}</div> {{/if}}
            </div>

            <div class="mb-3">
                <label class="form-label">Phone Number</label>
                <input type="text" class="form-control" name="numberPhone" id="numberPhone" placeholder="Examples: 076384xxxx" value="{{numberPhone}}">
                {{#if errors.numberPhone}} <div class="text-danger">{{errors.numberPhone}}</div> {{/if}}
            </div>

            <div class="mb-3">
                <label class="form-label">Avatar</label>
                <input type="file" class="form-control" name="avatar" id="avatar">
                {{#if errors.avatar}} <div class="text-danger">{{errors.avatar}}</div> {{/if}}
            </div>

            <div class="mb-3">
                <label class="form-label">Role</label>
                <select class="form-control" name="role" id="role">
                    <option value="sub_admin" {{#if (eq role "sub_admin")}}selected{{/if}}>Sub Admin</option>
                    <option value="user" {{#if (eq role "user")}}selected{{/if}}>User</option>
                </select>
                {{#if errors.role}} <div class="text-danger">{{errors.role}}</div> {{/if}}
            </div>

            <div class="d-flex" style="float: right;">
                <button type="submit" class="btn btn-system btn-submit">Submit</button>
                <button type="button" onclick="javascript:history.back()" class="btn btn-secondary btn-previou">Back</button>
            </div>
        </form>
    </div>

    <!-- Form thêm bằng file -->
    <div id="fileForm" style="display: none;">
        <form action="/admin/user/importUsers" method="POST" enctype="multipart/form-data" class="col-md-6 offset-md-3">
            <div class="mb-3">
                <label class="form-label">Upload File (CSV, Excel)</label>
                <input type="file" class="form-control" name="userFile" id="userFile" accept=".csv, .xlsx">
            </div>

            <div class="d-flex" style="float: right;">
                <button type="submit" class="btn btn-system btn-submit">Upload</button>
                <button type="button" onclick="javascript:history.back()" class="btn btn-secondary btn-previou">Back</button>
            </div>

        </form>

        <!-- Danh sách file đã tải lên -->
        
        <h3 class="mt-4">Uploaded Files</h3>
        <div class="card-body">
        <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead>
                    <tr>
                        <th>Active status</th>
                        <th>Role</th>
                        <th>Full name</th>
                        <th>User name</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each accounts}}
                    <tr>
                        <td style="color: {{#if this.isDeleted}} red {{else}} green {{/if}}">
                            {{#if this.isDeleted}} Vô hiệu hóa {{else}} Đang hoạt động {{/if}}
                        </td>
                        <td>{{#if (eq this.role "sub_admin")}}SUB ADMIN{{else}}USER{{/if}}</td>
                        <td>{{this.profile.fullName}}</td>
                        <td>{{this.username}}</td>
                        <td>
                            {{#if this.passwordDecrypted}}
                            <span class="password-hidden" id="password-{{@index}}">********</span>
                            <span class="password-visible" id="password-visible-{{@index}}" style="display: none;">{{this.passwordDecrypted}}</span>
                            <button type="button" onclick="togglePassword({{@index}})" class="btn btn-sm btn-outline-primary">Xem mật khẩu</button>
                            {{else}}
                                <span>Bảo mật Google</span>
                            {{/if}}
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
            <button type="button" onclick="javascript:history.back()" class="btn btn-secondary btn-previou">Back</button>
        </div>

    </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    // Lấy phần tử bằng ID
    const manualBtn = document.getElementById("manualBtn");
    const fileBtn = document.getElementById("fileBtn");
    const manualForm = document.getElementById("manualForm");
    const fileForm = document.getElementById("fileForm");
    
    // Kiểm tra xem các phần tử có tồn tại không trước khi gán sự kiện
    if (manualBtn && fileBtn && manualForm && fileForm) {
        // Ẩn cả hai form ban đầu
        manualForm.style.display = "none";
        fileForm.style.display = "none";

        // Khi bấm "Add Manually" thì hiển thị form thủ công, ẩn form file
        manualBtn.addEventListener("click", function() {
            manualForm.style.display = "block";
            fileForm.style.display = "none";
        });

        // Khi bấm "Import from File" thì hiển thị form file, ẩn form thủ công
        fileBtn.addEventListener("click", function() {
            manualForm.style.display = "none";
            fileForm.style.display = "block";
        });
    }

    {{!-- // Kiểm tra biến isCreate từ server để hiển thị thông báo thành công
    const isCreate = {{isCreate}};
    if (isCreate) {
        Swal.fire({
            title: 'Tạo người dùng thành công!',
            icon: 'success',
            confirmButtonText: 'OK'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = '/admin/user/listAllUser';
            }
        });
        fetch('/admin/user/clear-create-flag', { method: 'POST' });
    } --}}
});
</script>
