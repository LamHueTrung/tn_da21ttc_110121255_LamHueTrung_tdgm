<div class="row add-user mb-4">
    <h1 class="title-add-user text-center mb-4">Thêm người dùng</h1>

    <!-- Form thêm thủ công -->
    <div id="manualForm">
        <form id="createUserForm" enctype="multipart/form-data" class="col-md-6 offset-md-3">
            <div class="mb-3">
                <label class="form-label">Tài khoản</label>
                <input type="text" class="form-control" name="userName" id="userName" placeholder="Example: LamHueTrung">
                <div id="userNameError" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Quyền hạn</label>
                <select name="role" id="role" class="form-control">
                    <option value="0">--Chọn quyền--</option>
                    <option value="device_manager">Quản lý thiết bị</option>
                    <option value="gift_manager">Quản lý quà tặng</option>
                </select>
                <div id="roleError" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Họ và tên</label>
                <input type="text" class="form-control" name="fullName" id="fullName" placeholder="Example: Lâm Huệ Trung">
                <div id="fullNameError" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Ngày sinh</label>
                <input type="date" class="form-control" name="birthday" id="birthday">
                <div id="birthdayError" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Số điện thoại</label>
                <input type="text" class="form-control" name="numberPhone" id="numberPhone" placeholder="Examples: 076384xxxx">
                <div id="numberPhoneError" class="text-danger"></div>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" class="form-control" name="email" id="email" placeholder="Examples: example@gmail.com">
                <div id="emailError" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Địa chỉ</label>
                <input type="text" class="form-control" name="address" id="address" placeholder="Examples: Trà Vinh">
                <div id="addressError" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Ảnh đại diện</label>
                <input type="file" class="form-control" name="avatar" id="avatar">
                <div id="avatarError" class="text-danger"></div>
            </div>

            <div class="d-flex" style="float: right;">
                <button type="submit" class="btn btn-system btn-submit">Tạo mới</button>
                <button type="button" onclick="javascript:history.back()" class="btn btn-secondary btn-previou">Quay lại</button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("createUserForm").addEventListener("submit", function (event) {
        event.preventDefault(); // Ngăn chặn gửi form theo phương thức POST

        const formData = new FormData(this); // Lấy dữ liệu từ form

        if (formData.get("role") == 0) {
            Swal.fire('Lỗi', 'Vui lòng chọn quyền hạn cho tài khoản', 'error');
            return;
        }

        // Gửi yêu cầu API để tạo tài khoản mới
        fetch('/api/user/create', {
            method: 'POST',
            body: formData,
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                Swal.fire({
                    title: "Tạo tài khoản thành công!",
                    icon: "success",
                    timer: 2000,
                    showConfirmButton: false,
                }).then(() => {
                    window.location.href = '/users/ListAllUser'; // Chuyển đến danh sách người dùng hoặc trang khác
                });
            } else {
                // Hiển thị lỗi từ API
                if (data.errors) {
                    // Hiển thị lỗi từng trường
                    document.getElementById("userNameError").textContent = data.errors.userName || "";
                    document.getElementById("roleError").textContent = data.errors.role || "";
                    document.getElementById("fullNameError").textContent = data.errors.fullName || "";
                    document.getElementById("birthdayError").textContent = data.errors.birthday || "";
                    document.getElementById("numberPhoneError").textContent = data.errors.numberPhone || "";
                    document.getElementById("emailError").textContent = data.errors.email || "";
                    document.getElementById("addressError").textContent = data.errors.address || "";
                    document.getElementById("avatarError").textContent = data.errors.avatar || "";
                }
                Swal.fire('Lỗi', 'Có lỗi xảy ra, vui lòng kiểm tra lại thông tin', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            Swal.fire('Lỗi', 'Có lỗi xảy ra, vui lòng thử lại', 'error');
        });
    });
});
</script>
